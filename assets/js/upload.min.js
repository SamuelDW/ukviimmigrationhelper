function createContactList(e,t){return-1===e.indexOf(t.participentOne)&&e.push(t.participentOne),-1===e.indexOf(t.participentTwo)&&e.push(t.participentTwo),e}function getUniqueCalls(e){let t={};return e.filter(function(e){return!t[e.callId]&&(t[e.callId]=!0,!0)})}function combineCalls(e){let t,l,a=[];if(e.forEach(e=>{"ended"===e.callType&&(l=e),"started"===e.callType&&(t=e),"missed"===e.callType&&a.push(e)}),a.length>0||!l)return;let n={};return n.timeStarted=t.callDate,n.timeEnded=l.callDate,n.whoStartedCall=t.whoStartedCall,n.duration=l.duration,n.participentOne=t.participentOne,n.participentTwo=t.participentTwo,n.callId=t.callId,n.date=t.callDate,n}function getAllCallEvents(e){let t=[];return e.forEach(e=>{e.MessageList.forEach(e=>{"Event/Call"===e.messagetype&&t.push(e)})}),t}function createCallInformationObject(e){let t=(new DOMParser).parseFromString(e.content,"text/xml"),l=t.getElementsByTagName("partlist")[0];if(!l.attributes.type||!l.attributes.callId)return;let a={};return 0!==t.getElementsByTagName("duration").length&&(a.duration=t.getElementsByTagName("duration")[0].innerHTML),a.callId=l.attributes.callId.value,a.whoStartedCall=e.displayName,a.callDate=new Date(e.originalarrivaltime),a.callType=l.attributes.type.value,callParticipents=getCallParticipents(t.getElementsByTagName("name")),a.participentOne=callParticipents[0],a.participentTwo=callParticipents[1],a.whoStartedCall||(a.whoStartedCall=a.participentOne),a}function getCallParticipents(e){return[e[0].innerHTML,e[1].innerHTML]}window.addEventListener("load",function(){let e=[];document.getElementById("tar-upload-input").addEventListener("change",function(t){let l=document.getElementById("skype-table").getElementsByTagName("tbody")[0];if(l.rows.length>0)for(let e=l.rows.length;e>0;e--)l.deleteRow(l.rows[e]);let a=[],n=[],i=new FileReader;i.onload=function(t){getAllCallEvents(JSON.parse(t.target.result).conversations).forEach(t=>{let l=createCallInformationObject(t);l&&(e=createContactList(e,l),a.push(l))});for(let e=0;e<a.length;e++){let t=a[e].callId,l=a.filter(e=>e.callId===t);if(l.length>1){let e=combineCalls(l);e&&n.push(e)}}let l=getUniqueCalls(n);displayResultsAsTable(l,"skype-table"),populateCallRemoval(e,"select-remove"),populateCallRemoval(e,"name-being-changed-select"),populateHiddenField(e,"contacts-hidden"),document.querySelector("#skype-display-table").classList.remove("hidden"),document.querySelectorAll(".table-remove-row-checkbox").forEach(e=>{e.addEventListener("click",function(){!0===e.checked&&e.parentElement.parentElement.classList.toggle("hidden")})})},i.readAsText(t.target.files[0])})});
